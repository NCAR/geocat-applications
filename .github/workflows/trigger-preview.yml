name: trigger-preview
on:
  workflow_run:
    workflows:
      - trigger-build
    types:
      - requested
      - completed

  workflow_call:

jobs:
  get-pr-number:
    runs-on: ubuntu-latest
    outputs:
      PR_NUMBER: ${{ steps.get_pr_number.outputs.PR_NUMBER }}
    steps:
      - name: Get PR number
        id: get_pr_number
        run: echo "::set-output name=PR_NUMBER::$(echo ${{ github.event.workflow_run.payload.inputs.pr_number }})"
  build-for-preview:
    if: github.event.workflow_run.conclusion == 'success'
    uses: './.github/workflows/build.yml'
    with:
      artifact_name: docs-zip-${{ needs.get-pr-number.outputs.PR_NUMBER }}
      build_from_code_artifact: true
      code_artifact_name: code-zip-${{ needs.get-pr-number.outputs.PR_NUMBER }}
